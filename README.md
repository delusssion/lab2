# Лабораторная работа №2 — Shell-эмулятор

Простой консольный Shell с поддержкой основных команд работы с файловой системой, архивации, поиска и истории команд.

## Цель проекта
Реализовать функциональный эмулятор командной оболочки с поддержкой базовых Unix-команд (ls, cd, cat, cp, mv, rm), операций с архивами (zip/tar), поиском по содержимому файлов (grep), а также механизмом истории команд с возможностью отмены последних операций (undo).

## Структура проекта

```
lab2/
├── src/
│ ├── __init__.py
│ ├── .trash
│ ├── shell.log
│ ├── constants.py
│ ├── main.py 
│ ├── shell.py 
│ ├── ls.py 
│ ├── cd.py
│ ├── cat.py
│ ├── cp.py
│ ├── mv.py 
│ ├── rm.py
│ ├── grep.py 
│ ├── archive.py 
│ ├── history_manager.py
│ ├── logger.py 
│ └── errors.py
├── tests/
│ ├── __init__.py
│ ├── conftest.py 
│ ├── test_ls.py
│ ├── test_cd.py
│ ├── test_cat.py
│ ├── test_cp.py
│ ├── test_mv.py
│ ├── test_rm.py
│ ├── test_grep.py
│ ├── test_archive.py
│ ├── test_errors.py
│ └── test_history.py
├── .gitignore
├── .pre-commit-config.yaml
├── pyproject.toml
├── README.md
├── requirements.txt
└── uv.lock
```

## Используемые технологии
- Python 3.13+ (совместимость указана в pyproject.toml)
- pytest — модульное тестирование (73 теста)
- mypy, ruff — статический анализ и линтинг
- pre-commit — автоматические хуки проверки кода

## Реализованные команды

### Базовые 

1. **ls [path] [-l]** — Отображение содержимого директории
   - Поддержка абсолютных и относительных путей
   - Опция `-l` для детального отображения (права | тип | размер | дата создания | название)
   - Расшифровка прав доступа:
      * Первый символ: d - директория, - - файл, l - ссылка
      * Символы 2-4: rwx - права владельца (read, write, execute)
      * Символы 5-7: r-x - права группы
      * Символы 8-10: r-- - права для всех остальных
   - Сортировка: директории перед файлами

2. **cd [path]** — Переход в директорию
   - Поддержка `..` (родительская директория) и `~` (домашняя директория)
   - Обработка ошибок (несуществующая директория)

3. **cat <file>** — Вывод содержимого файла
   - Защита от чтения слишком больших файлов (более 10MB)
   - Обработка ошибок (файл не существует/это директория)

4. **cp <source> <dest> [-r]** — Копирование файлов/директорий
   - Опция `-r` для рекурсивного копирования директорий
   - Проверка на самокопирование

5. **mv <source> <dest>** — Перемещение/переименование
   - Поддержка перемещения в существующую директорию
   - Проверка существования источника

6. **rm <target> [-r]** — Удаление файлов/директорий
   - Опция `-r` для рекурсивного удаления директорий
   - Подтверждение при удалении директорий
   - Защита от удаления системных директорий (/, ~)
   - Безопасное удаление с перемещением в корзину (.trash)

7. **Логирование** — Все команды записываются в `shell.log` 
   - Формат: `[дата время] команда`
   - Логирование ошибок
   - По достижении shell.log веса 1MB создается новый shell1.log и так далее

### Дополнительные возможности

8. **Архивы (zip/tar)**
   - `zip <folder> <archive.zip>` — Создание ZIP архива
   - `unzip <archive.zip>` — Распаковка ZIP архива
   - `tar <folder> <archive.tar.gz>` — Создание TAR.GZ архива
   - `untar <archive.tar.gz>` — Распаковка TAR.GZ архива

9. **grep <pattern> <path> [-r] [-i]** — Поиск по содержимому
   - Поиск строк по регулярному выражению
   - Опция `-r` — рекурсивный поиск в подкаталогах
   - Опция `-i` — поиск без учёта регистра
   - Вывод: имя файла, номер строки, найденный фрагмент

10. **История команд и undo**
    - `history [N]` — Вывод последних N команд (по умолчанию 10)
    - `undo` — Отмена последней операции cp/mv/rm
      - Для cp: удаление скопированного объекта
      - Для mv: возврат объекта в исходное место
      - Для rm: восстановление из корзины (.trash)
    - История сохраняется в `.history` между запусками

11. **Очистка корзины**
    - `clear_trash` - Команда для удаления всего содержимого в .trash


## Принятые решения и допущения

### Архитектура
- **Модульная структура**: каждая команда в отдельном файле
- **Безопасное удаление**: файлы перемещаются в `.trash` вместо полного удаления (опционально, корзина может быть очищена)
- **История операций**: отслеживаются операции изменения

### Обработка ошибок
- Все ошибки перехватываются и выводятся в читаемом формате
- Ошибки записываются в лог
- Недопустимые операции (удаление /, ~, etc) блокируются

### Особенности реализации
- Унарные флаги (-r, -l, -i) поддерживаются в любом порядке (cp -r dir dir_copy ИЛИ cp dir -r dir_copy, etc)
- Корзина (.trash) создаётся автоматически
- Поддержка как абсолютных, так и относительных путей
- История хранит последние 100 команд (+ все команды, вызванные в текущей сессии shell'а)
- Все константы вынесены в отдельный файл constants.py и названы в стиле UPPER_CASE

## Тестирование

### Структура тестов
- **73 модульных тестов** с полным покрытием функциональности
- Тесты для успешных сценариев и ошибок
- Использование fake filesystem

### Запуск тестов

Все тесты:
```
python3 -m pytest
```

С подробным выводом:
```
python3 -m pytest -v
```

С кратким:
```
python3 -m pytest -q
```

## Программа

### Установка

1. Создать и активировать виртуальное окружение:
```
python3 -m venv venv
source venv/bin/activate # macOS/Linux
```
ИЛИ
```
venv\Scripts\activate #Windows
```

2. Установить зависимости:
```
pip install -r requirements.txt
```

### Запуск

Интерактивный режим:
```
python3 -m src.main
```
ИЛИ
```
python3 src/main.py
```

### Завершение работы
```
exit # в терминале
```
